{% extends 'admin/base.html' %}
{% block title %}Линейки{% endblock %}
{% block page_title %}Линейки продукции{% endblock %}

{% block content %}
<div class="card">
    <div class="list-toolbar">
        <div class="toolbar-actions">
            <a href="{{ url_for('admin.product_lines_add') }}" class="btn btn-success">Добавить линейку</a>
            <a href="{{ url_for('admin.product_lines_import') }}" class="btn btn-secondary">Импорт CSV</a>
            <a href="{{ url_for('admin.csv_export_product_lines', search=search, category_id=selected_category) }}" class="btn btn-outline">Скачать CSV</a>
        </div>
        <div class="toolbar-search">
            <form method="GET" class="search-form">
                <input type="hidden" name="category_id" value="{{ selected_category }}">
                <input type="text" name="search" value="{{ search }}" placeholder="Поиск по категории и названию..." class="search-input">
                <button type="submit" class="btn btn-primary btn-sm">Найти</button>
                {% if search or selected_category %}
                <a href="{{ url_for('admin.product_lines_list') }}" class="btn btn-outline btn-sm">Сбросить</a>
                {% endif %}
            </form>
        </div>
    </div>
    
    <div class="filters-row">
        <form method="GET" class="filter-form">
            {% if search %}
            <input type="hidden" name="search" value="{{ search }}">
            {% endif %}
            <label>Категория:
                <select name="category_id" onchange="this.form.submit()">
                    <option value="">Все категории</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}" {{ 'selected' if selected_category|string == cat.id|string }}>{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </label>
        </form>
    </div>
    
    <table>
        <thead>
            <tr><th>Категория</th><th>Название</th><th>Slug</th><th>Активна</th><th>Действия</th></tr>
        </thead>
        <tbody>
            {% for pl in product_lines %}
            <tr>
                <td>{{ pl.category.name }}</td>
                <td>{{ pl.name }}</td>
                <td>{{ pl.slug }}</td>
                <td>{{ 'Да' if pl.is_active else 'Нет' }}</td>
                <td class="actions">
                    <a href="{{ url_for('admin.product_lines_edit', id=pl.id) }}" class="btn btn-sm btn-primary">Изменить</a>
                    <form action="{{ url_for('admin.product_lines_delete', id=pl.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Удалить?')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="5" style="text-align:center;color:#888;">Нет линеек</td></tr>
            {% endfor %}
        </tbody>
    </table>
    <p style="margin-top:10px;color:#666;">Найдено: {{ product_lines|length }}</p>
</div>
{% endblock %}
