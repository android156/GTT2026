{% extends 'base.html' %}

{% block hero %}
<h1 class="visually-hidden">{{ seo.h1 }}</h1>
{% if hero %}
<section class="hero page-hero" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('{{ hero.image }}');">
    <div class="container">
        <div class="hero-content">
            <div class="hero-main-title">{{ hero.title }}</div>
            {% if hero.subtitle %}<p class="hero-desc">{{ hero.subtitle }}</p>{% endif %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block content %}
<nav class="breadcrumbs">
    {% for crumb in breadcrumbs %}
    {% if crumb.url %}
    <a href="{{ crumb.url }}">{{ crumb.name }}</a> /
    {% else %}
    <span>{{ crumb.name }}</span>
    {% endif %}
    {% endfor %}
</nav>

<div class="page-content">
    {{ page.content_html|safe }}
    
    {% if document_types is not none %}
    <div class="documents-filter">
        <form method="GET" class="filter-form">
            <div class="filter-row">
                <div class="filter-types">
                    <select name="type" onchange="this.form.submit()" class="filter-select">
                        <option value="" {% if not current_type_slug %}selected{% endif %}>–í—Å–µ —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</option>
                        {% for dt in document_types %}
                        <option value="{{ dt.slug }}" {% if current_type_slug == dt.slug %}selected{% endif %}>{{ dt.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="filter-search">
                    <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." value="{{ search_query or '' }}">
                    <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
                </div>
            </div>
        </form>
    </div>
    
    <div class="documents-list">
        {% for doc in documents %}
        <div class="document-item">
            {% if doc.document_type and doc.document_type.has_own_page and doc.slug %}
            <a href="{{ url_for('public.document_page', slug=doc.slug) }}" class="document-link">
            {% else %}
            <a href="{{ doc.file_path }}" target="_blank" class="document-link">
            {% endif %}
                <span class="document-icon">üìÑ</span>
                <span class="document-name">{{ doc.title }}</span>
            </a>
            {% if doc.description %}
            <p class="document-description">{{ doc.description }}</p>
            {% endif %}
            {% if doc.document_type %}
            <div class="document-type-badge">
                <span class="type-name">{{ doc.document_type.name }}</span>
                <span class="type-date">{{ doc.created_at.strftime('%d.%m.%Y') if doc.created_at else '' }}</span>
            </div>
            {% endif %}
        </div>
        {% else %}
        <p style="text-align:center; color: #999;">–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if page.url_path == '/contacts/' %}
    <div id="map" style="width: 100%; height: 450px; margin-top: 30px; border: 1px solid var(--border-color);"></div>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <script>
        ymaps.ready(function () {
            var myMap = new ymaps.Map("map", {
                center: [55.899786, 37.552003], // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞ (–ú–æ—Å–∫–≤–∞, –õ–∏–∞–Ω–æ–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ–µ–∑–¥, 6)
                zoom: 16
            });

            var myPlacemark = new ymaps.Placemark(myMap.getCenter(), {
                hintContent: '–ì—Ä—É–ø–ø–∞ –ì–õ–ê–í–¢–†–£–ë–¢–û–†–ì',
                balloonContent: '127253, –ú–æ—Å–∫–≤–∞, –õ–∏–∞–Ω–æ–∑–æ–≤—Å–∫–∏–π –ø—Ä–æ–µ–∑–¥, –¥–æ–º 6'
            });

            myMap.geoObjects.add(myPlacemark);
        });
    </script>
    {% endif %}
    {% if page.url_path == '/contacts/' or page.url_path == '/price/' %}
    <section class="service-cta-section" id="callback" style="margin-top: 60px;">
        <div class="cta-content">
            <div class="cta-info">
                {% if page.url_path == '/price/' %}
                <h3>–ù—É–∂–µ–Ω —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏?</h3>
                <p>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏ –ø–æ –∑–∞—è–≤–∫–µ</p>
                {% else %}
                <h3>–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã?</h3>
                <p>–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É, –∏ –Ω–∞—à —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç.</p>
                {% endif %}
            </div>
        </div>
        <div class="cta-form-wrapper">
            <form action="{{ url_for('public.submit_lead') }}" method="POST" class="lead-form service-lead-form" id="contacts-lead-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="page_url" value="{{ request.url }}">
                {% if page.url_path == '/price/' %}
                <input type="hidden" name="message" value="–ó–∞–ø—Ä–æ—Å —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ü–µ–Ω">
                {% endif %}
                <input type="hidden" name="utm_source" value="">
                <input type="hidden" name="utm_medium" value="">
                <input type="hidden" name="utm_campaign" value="">
                <input type="hidden" name="utm_term" value="">
                <input type="hidden" name="utm_content" value="">
                <input type="hidden" name="captcha_token" id="contacts-captcha-token" value="">
                <div style="display:none !important;"><input type="text" name="website" tabindex="-1" autocomplete="off"></div>
                <div class="form-row">
                    <input type="text" name="name" placeholder="–í–∞—à–µ –∏–º—è" required>
                </div>
                <div class="form-row">
                    <input type="tel" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
                </div>
                <div class="form-row">
                    <input type="email" name="email" placeholder="Email">
                </div>
                {% if page.url_path == '/contacts/' %}
                <div class="form-row">
                    <textarea name="message" placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ" style="width: 100%; min-height: 100px; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius); margin-bottom: 15px; font-family: inherit;"></textarea>
                </div>
                {% endif %}
                <div class="form-row captcha-row">
                    <label id="contacts-captcha-question">–ó–∞–≥—Ä—É–∑–∫–∞...</label>
                    <input type="number" name="captcha_answer" placeholder="–û—Ç–≤–µ—Ç" required>
                </div>
                <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
        </div>
    </section>
    {% endif %}

    {% if statutory_docs %}
    <div class="statutory-docs-section">
        <h3>–£—á—Ä–µ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</h3>
        <div class="statutory-docs-grid">
            {% for doc in statutory_docs %}
            {% set doc_url = url_for('public.document_page', slug=doc.slug) if doc.document_type and doc.document_type.has_own_page and doc.slug else doc.file_path %}
            <div class="statutory-card-wrapper">
                <a href="{{ doc_url }}" class="statutory-card" {% if not (doc.document_type and doc.document_type.has_own_page and doc.slug) %}target="_blank"{% endif %}>
                    <div class="statutory-card-icon">üìÑ</div>
                    <div class="statutory-card-content">
                        <div class="statutory-card-name">{{ doc.title }}</div>
                        {% if doc.description %}
                        <div class="statutory-card-desc">{{ doc.description }}</div>
                        {% endif %}
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{% if seo.seo_text %}
<div class="seo-text">{{ seo.seo_text|safe }}</div>
{% endif %}
{% endblock %}
