{% extends 'base.html' %}

{% block hero %}
{% set h1_text = "Труба " ~ seo.h1 %}
<h1 class="visually-hidden">{{ h1_text }}</h1>
{% set hero_img = size_item.image_path or product_line.get_main_image() or category.image_path or '/static/images/WhatsApp_Image_2019-10-21_at_13.44.44_1766758697538.jpeg' %}
<section class="hero page-hero" style="background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('{{ hero_img }}');">
    <div class="container">
        <div class="hero-content">
            <div class="hero-main-title">{{ h1_text }}</div>
        </div>
    </div>
</section>
{% endblock %}

{% block content %}
<nav class="breadcrumbs">
    {% for crumb in breadcrumbs %}
    {% if crumb.url %}
    <a href="{{ crumb.url }}">{{ crumb.name }}</a> /
    {% else %}
    <span>{{ crumb.name }}</span>
    {% endif %}
    {% endfor %}
</nav>

<div itemscope itemtype="http://schema.org/Product" class="product-detail">
    <div class="product-main">
        {% set h1_without_truba = seo.h1 %}
        <div class="product-title" style="font-size: 15px; font-weight: 700; margin-bottom: 16px; text-align: center; padding-top: 12px;">{{ h1_without_truba }}</div>
        {% set main_image = size_item.image_path or product_line.get_main_image() or category.image_path %}
        {% if main_image %}
        <img src="{{ main_image }}" alt="{{ h1_text }}" class="product-img" itemprop="image">
        {% else %}
        <div class="product-img placeholder"></div>
        {% endif %}
        
        {% set seo_desc = product_line.seo_description or '' %}
        {% if ' — ' in seo_desc %}
            {% set desc_after_dash = seo_desc.split(' — ', 1)[1] %}
        {% else %}
            {% set desc_after_dash = seo_desc %}
        {% endif %}
        <div class="seo-text" itemprop="description">{{ h1_without_truba }}{% if desc_after_dash %} — {{ desc_after_dash }}{% endif %}</div>
    </div>
    
    <div class="product-info">
        <div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
        <table class="product-specs">
            <tr>
                <th>Размер:</th>
                <td>{{ size_item.size_text }}</td>
            </tr>
            {% if size_item.pipe_dxs %}
            <tr>
                <th>Напорная труба DxS, мм:</th>
                <td>{{ size_item.pipe_dxs }}</td>
            </tr>
            {% endif %}
            {% if size_item.pressure %}
            <tr>
                <th>Давление:</th>
                <td>{{ size_item.pressure }}</td>
            </tr>
            {% endif %}
            {% if size_item.mass_per_m %}
            <tr>
                <th>Масса 1м, кг:</th>
                <td>{{ size_item.mass_per_m }}</td>
            </tr>
            {% endif %}
            {% if size_item.min_bend_radius %}
            <tr>
                <th>Мин. радиус изгиба, м:</th>
                <td>{{ size_item.min_bend_radius }}</td>
            </tr>
            {% endif %}
            {% if size_item.max_len_coil %}
            <tr>
                <th>Макс. длина в бухте, м:</th>
                <td>{{ size_item.max_len_coil }}</td>
            </tr>
            {% endif %}
            {% if size_item.max_len_drum %}
            <tr>
                <th>Макс. длина на барабане, м:</th>
                <td>{{ size_item.max_len_drum }}</td>
            </tr>
            {% endif %}
            <tr>
                <th>Цена:</th>
                <td class="price-cell">
                    {% set display_price = size_item.get_display_price() %}
                    {% set hide_price = size_item.get_effective_hide_price() %}
                    {% if display_price > 0 %}
                        {% if hide_price %}
                        <span class="price-hidden" aria-hidden="true">По запросу</span>
                        <span class="price-seo" style="position:absolute;left:-9999px;visibility:hidden;">
                            <span itemprop="price" content="{{ "%.2f"|format(display_price) }}">{{ "%.2f"|format(display_price) }}</span>
                            <span itemprop="priceCurrency" content="{{ size_item.currency }}">{{ size_item.currency }}</span>
                        </span>
                        {% else %}
                        <strong class="price">
                            <span itemprop="price" content="{{ "%.2f"|format(display_price) }}">{{ "%.2f"|format(display_price) }}</span>
                            <span itemprop="priceCurrency" content="{{ size_item.currency }}">{{ size_item.currency }}</span>
                        </strong>
                        {% if size_item.unit %} / {{ size_item.unit }}{% endif %}
                        {% endif %}
                    {% else %}
                    По запросу
                    <meta itemprop="price" content="0">
                    <meta itemprop="priceCurrency" content="RUB">
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Единица измерения:</th>
                <td>{{ size_item.unit or '-' }}</td>
            </tr>
            <tr>
                <th>Наличие:</th>
                <td>
                    {% if size_item.in_stock %}
                    <span class="in-stock">В наличии</span>
                    {% else %}
                    <span class="out-of-stock">Под заказ</span>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Артикул (SKU):</th>
                <td>{{ size_item.sku or '-' }}</td>
            </tr>
        </table>
        {% if size_item.in_stock %}
        <link itemprop="availability" href="http://schema.org/InStock">
        {% else %}
        <link itemprop="availability" href="http://schema.org/OutOfStock">
        {% endif %}
        </div>
        
        <div class="product-actions">
            <h3>Оставить заявку</h3>
            <form action="{{ url_for('public.submit_lead') }}" method="POST" class="lead-form" id="size-lead-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="message" value="Заявка на товар: {{ h1_text }}">
                <input type="hidden" name="page_url" value="{{ request.url }}">
                <input type="hidden" name="utm_source" value="">
                <input type="hidden" name="utm_medium" value="">
                <input type="hidden" name="utm_campaign" value="">
                <input type="hidden" name="utm_term" value="">
                <input type="hidden" name="utm_content" value="">
                <input type="hidden" name="captcha_token" id="size-captcha-token" value="">
                <div style="display:none !important;"><input type="text" name="website" tabindex="-1" autocomplete="off"></div>
                <div class="form-row">
                    <input type="text" name="name" placeholder="Ваше имя" required>
                    <input type="tel" name="phone" placeholder="Телефон" required>
                </div>
                <input type="email" name="email" placeholder="Email">
                <div class="form-row captcha-row">
                    <label id="size-captcha-question">Загрузка...</label>
                    <input type="number" name="captcha_answer" placeholder="Ответ" required>
                </div>
                <button type="submit" class="btn btn-primary">Отправить заявку</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
