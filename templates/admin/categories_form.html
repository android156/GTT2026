{% extends 'admin/base.html' %}
{% from 'admin/_wysiwyg.html' import wysiwyg_toolbar, wysiwyg_styles, wysiwyg_scripts %}
{% block title %}{{ 'Редактировать' if category else 'Добавить' }} категорию{% endblock %}
{% block page_title %}{{ 'Редактировать' if category else 'Добавить' }} категорию{% endblock %}

{% block content %}
<div class="card">
    <form method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <h3>Основная информация</h3>
        <div class="form-group">
            <label>Название <span class="required">*</span></label>
            <input type="text" name="name" value="{{ category.name if category else '' }}" required placeholder="Например: Трубы ИЗОКОМ">
            <small class="hint">Название категории, отображается на сайте и в каталоге</small>
        </div>
        <div class="form-group">
            <label>Slug <span class="required">*</span></label>
            <input type="text" name="slug" value="{{ category.slug if category else '' }}" required pattern="[a-z0-9_-]+" placeholder="Например: izokom">
            <small class="hint">Часть URL. Только латиница, цифры, дефис и подчёркивание. Пример: izokom → сайт.ру/izokom/</small>
        </div>
        
        <h3>Изображение</h3>
        <div class="form-group">
            <label>Загрузить изображение</label>
            {% if category and category.image_path %}
            <div class="current-image">
                <img src="{{ category.image_path }}" alt="Текущее изображение" style="max-width: 200px; max-height: 150px;">
                <div class="form-check" style="margin-top: 10px;">
                    <input type="checkbox" name="delete_image" id="delete_image">
                    <label for="delete_image">Удалить изображение</label>
                </div>
            </div>
            {% endif %}
            <input type="file" name="image_file" accept="image/*">
            <small class="hint">Рекомендуемый размер: 600x400 px. JPG, PNG, WebP. Автоматически сжимается до 85% качества</small>
        </div>
        
        <h3>Контент</h3>
        <div class="form-group">
            <label>Описание</label>
            {{ wysiwyg_toolbar('description_html') }}
            <textarea name="description_html" id="description_html" rows="5" class="wysiwyg-textarea" placeholder="Краткое описание категории...">{{ category.description_html if category else '' }}</textarea>
            <small class="hint">Текст отображается на странице категории. Можно использовать HTML-теги</small>
        </div>
        
        <h3>SEO настройки</h3>
        <div class="form-group">
            <label>SEO Title</label>
            <input type="text" name="seo_title" value="{{ category.seo_title if category else '' }}" placeholder="Например: Трубы ИЗОКОМ — купить в Москве | ГлавТрубТорг">
            <small class="hint">Заголовок страницы в браузере и поисковиках. Рекомендуется 50-70 символов</small>
        </div>
        <div class="form-group">
            <label>SEO Description</label>
            <textarea name="seo_description" rows="2" placeholder="Описание для поисковых систем...">{{ category.seo_description if category else '' }}</textarea>
            <small class="hint">Описание в результатах поиска. Рекомендуется 150-160 символов</small>
        </div>
        <div class="form-group">
            <label>H1 заголовок</label>
            <input type="text" name="h1" value="{{ category.h1 if category else '' }}" placeholder="Например: Трубы ИЗОКОМ">
            <small class="hint">Главный заголовок на странице. Если пусто — используется название категории</small>
        </div>
        <div class="form-group">
            <label>SEO текст</label>
            {{ wysiwyg_toolbar('seo_text_html') }}
            <textarea name="seo_text_html" id="seo_text_html" rows="4" class="wysiwyg-textarea" placeholder="Дополнительный текст для SEO внизу страницы...">{{ category.seo_text_html if category else '' }}</textarea>
            <small class="hint">Текст внизу страницы для поисковой оптимизации</small>
        </div>
        
        <h3>Hero-изображение</h3>
        <p class="section-desc">Фоновое изображение в шапке страницы категории</p>
        <div class="form-group">
            <label>URL Hero-изображения</label>
            <input type="text" name="hero_image" value="{{ category.hero_image if category else '' }}" placeholder="/static/images/hero.jpg">
            <small class="hint">Путь к изображению или внешний URL (если пусто - используется изображение категории)</small>
        </div>
        <div class="form-group">
            <label>Заголовок в Hero</label>
            <input type="text" name="hero_title" value="{{ category.hero_title if category else '' }}">
            <small class="hint">Крупный текст поверх изображения (если пусто - название категории)</small>
        </div>
        <div class="form-group">
            <label>Подзаголовок в Hero</label>
            <input type="text" name="hero_subtitle" value="{{ category.hero_subtitle if category else '' }}">
            <small class="hint">Дополнительный текст</small>
        </div>
        
        <h3>Настройки отображения</h3>
        <div class="form-group">
            <label>Порядок сортировки</label>
            <input type="number" name="sort_order" value="{{ category.sort_order if category else 0 }}" placeholder="0">
            <small class="hint">Категории сортируются по возрастанию. 10, 20, 30...</small>
        </div>
        <div class="form-group form-check">
            <input type="checkbox" name="is_active" id="is_active" {{ 'checked' if category and category.is_active else 'checked' if not category else '' }}>
            <label for="is_active">Активна</label>
            <small class="hint">Неактивные категории не отображаются на сайте</small>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Сохранить</button>
            <a href="{{ url_for('admin.categories_list') }}" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
</div>

{{ wysiwyg_styles() }}
{{ wysiwyg_scripts() }}
{% endblock %}
