{% extends 'admin/base.html' %}
{% block title %}{{ 'Редактировать' if size_item else 'Добавить' }} типоразмер{% endblock %}
{% block page_title %}{{ 'Редактировать' if size_item else 'Добавить' }} типоразмер{% endblock %}

{% block content %}
<div class="nav-controls" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <div>
        {% if prev_id %}
        <a href="{{ url_for('admin.size_items_edit', id=prev_id) }}" class="btn btn-secondary">&larr; Предыдущий</a>
        {% else %}
        <button class="btn btn-secondary" disabled style="opacity: 0.5;">&larr; Предыдущий</button>
        {% endif %}
        
        {% if next_id %}
        <a href="{{ url_for('admin.size_items_edit', id=next_id) }}" class="btn btn-secondary">Следующий &rarr;</a>
        {% else %}
        <button class="btn btn-secondary" disabled style="opacity: 0.5;">Следующий &rarr;</a>
        {% endif %}
    </div>
    {% if size_item %}
    <p class="section-desc" style="margin: 0;">Линейка: <strong>{{ size_item.product_line.name }}</strong></p>
    {% endif %}
</div>

<div class="card">
    <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <label>Линейка продукции</label>
            <select name="product_line_id" required>
                {% for pl in product_lines %}
                <option value="{{ pl.id }}" {{ 'selected' if size_item and size_item.product_line_id == pl.id else '' }}>{{ pl.category.name }} / {{ pl.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>Размер (например: 40/75)</label>
            <input type="text" name="size_text" value="{{ size_item.size_text if size_item else '' }}" required>
        </div>
        <div class="form-group">
            <label>Slug размера (например: 40_75)</label>
            <input type="text" name="size_slug" value="{{ size_item.size_slug if size_item else '' }}">
        </div>
        <div class="form-group">
            <label>Артикул (SKU)</label>
            <input type="text" name="sku" value="{{ size_item.sku if size_item else '' }}">
        </div>
        <div class="form-group">
            <label>Цена</label>
            <input type="number" step="0.01" name="price" value="{{ size_item.price if size_item else 0 }}">
        </div>
        <div class="form-group">
            <label>Валюта</label>
            <select name="currency">
                <option value="RUB" {{ 'selected' if not size_item or size_item.currency == 'RUB' else '' }}>RUB</option>
                <option value="USD" {{ 'selected' if size_item and size_item.currency == 'USD' else '' }}>USD</option>
                <option value="EUR" {{ 'selected' if size_item and size_item.currency == 'EUR' else '' }}>EUR</option>
            </select>
        </div>
        <div class="form-group">
            <label>Единица измерения</label>
            <input type="text" name="unit" value="{{ size_item.unit if size_item else 'шт' }}">
        </div>
        <div class="form-group">
            <label>Путь к изображению</label>
            <input type="text" name="image_path" value="{{ size_item.image_path if size_item else '' }}">
        </div>
        <div class="form-group form-check">
            <input type="checkbox" name="in_stock" id="in_stock" {{ 'checked' if size_item and size_item.in_stock else 'checked' if not size_item else '' }}>
            <label for="in_stock">В наличии</label>
        </div>
        
        <hr>
        <h3>Индивидуальные настройки цены</h3>
        <p class="section-desc">Переопределяет настройки линейки для этого типоразмера. Оставьте пустым для использования настроек линейки.</p>
        <div class="form-row" style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="form-group" style="flex: 1; min-width: 200px;">
                <label>Скидка % (индивидуальная)</label>
                <input type="number" name="discount_percent" value="{{ size_item.discount_percent if size_item and size_item.discount_percent is not none else '' }}" min="0" max="100" step="0.01" style="width: 120px;" placeholder="—">
                <small class="hint">Если заполнено — используется вместо скидки линейки</small>
            </div>
            <div class="form-group" style="flex: 1; min-width: 200px;">
                <label>Скрыть цену</label>
                <select name="hide_price_option" style="width: 180px;">
                    <option value="" {{ 'selected' if not size_item or size_item.hide_price is none else '' }}>— Как в линейке —</option>
                    <option value="show" {{ 'selected' if size_item and size_item.hide_price == false else '' }}>Показывать</option>
                    <option value="hide" {{ 'selected' if size_item and size_item.hide_price == true else '' }}>Скрывать</option>
                </select>
                <small class="hint">Переопределяет настройку линейки</small>
            </div>
        </div>
        <hr>
        
        <div class="form-group">
            <label>Напорная труба DxS, мм</label>
            <input type="text" name="pipe_dxs" value="{{ size_item.pipe_dxs if size_item else '' }}">
        </div>
        <div class="form-group">
            <label>Давление</label>
            <input type="text" name="pressure" value="{{ size_item.pressure if size_item else '' }}">
        </div>
        <div class="form-group">
            <label>Масса 1м, кг</label>
            <input type="text" name="mass_per_m" value="{{ size_item.mass_per_m if size_item else '' }}">
        </div>
        <div class="form-group">
            <label>Мин. радиус изгиба, м</label>
            <input type="text" name="min_bend_radius" value="{{ size_item.min_bend_radius if size_item else '' }}">
        </div>
        <div class="form-group">
            <label>Макс. длина в бухте, м</label>
            <input type="text" name="max_len_coil" value="{{ size_item.max_len_coil if size_item else '' }}">
        </div>
        <div class="form-group">
            <label>Макс. длина на барабане, м</label>
            <input type="text" name="max_len_drum" value="{{ size_item.max_len_drum if size_item else '' }}">
        </div>
        <button type="submit" class="btn btn-primary">Сохранить</button>
        <a href="{{ url_for('admin.size_items_list') }}" class="btn btn-secondary">Отмена</a>
    </form>
</div>
{% endblock %}
