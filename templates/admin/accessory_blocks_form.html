{% extends 'admin/base.html' %}
{% from 'admin/_wysiwyg.html' import wysiwyg_editor, wysiwyg_styles, wysiwyg_scripts %}
{% block title %}{{ 'Редактировать' if block else 'Добавить' }} блок комплектующих{% endblock %}
{% block page_title %}{{ 'Редактировать' if block else 'Добавить' }} блок комплектующих{% endblock %}

{% block content %}
<div class="card">
    <p class="section-desc">Линейка: <strong>{{ product_line.name }}</strong></p>
    
    <form method="POST" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="form-group">
            <label>Название блока <span class="required">*</span></label>
            <input type="text" name="name" value="{{ block.name if block else '' }}" required placeholder="Например: Фитинги и соединения">
            <small class="hint">Заголовок блока, отображается как H2</small>
        </div>
        
        <div class="form-group">
            <label>Описание</label>
            {{ wysiwyg_editor('description_html', 'description_html', block.description_html if block else '') }}
            <small class="hint">Текст перед таблицей комплектующих</small>
        </div>
        
        <div class="form-group">
            <label>Галерея изображений</label>
            <input type="file" name="gallery_images" multiple accept="image/*" class="form-control">
            <small class="hint">Выберите одно или несколько изображений. После сохранения вы сможете настроить их SEO-параметры.</small>
            
            {% if block and block.images.count() > 0 %}
            <div class="gallery-admin-grid">
                {% for img in block.images.order_by('sort_order').all() %}
                <div class="gallery-admin-item">
                    <img src="{{ img.image_path }}" alt="">
                    <div class="gallery-admin-fields">
                        <input type="text" name="alt_{{ img.id }}" value="{{ img.alt_text }}" placeholder="ALT текст">
                        <input type="text" name="title_{{ img.id }}" value="{{ img.title_text }}" placeholder="Title текст">
                        <input type="text" name="caption_{{ img.id }}" value="{{ img.caption }}" placeholder="Подпись">
                        <div class="row-fields">
                            <input type="number" name="sort_{{ img.id }}" value="{{ img.sort_order }}" placeholder="Сортировка" style="width: 80px;">
                            <label><input type="checkbox" name="no_wm_{{ img.id }}" {{ 'checked' if img.no_watermark }}> Без WM</label>
                            <label class="delete-label"><input type="checkbox" name="delete_images[]" value="{{ img.id }}"> Удалить</label>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label>Таблица (HTML)</label>
            {{ wysiwyg_editor('table_html', 'table_html', block.table_html if block else '') }}
            <small class="hint">HTML-таблица с типоразмерами комплектующих</small>
        </div>
        
        <div class="form-group">
            <label>Порядок сортировки</label>
            <input type="number" name="sort_order" value="{{ block.sort_order if block else 0 }}" placeholder="0">
            <small class="hint">Меньшее значение — выше в списке</small>
        </div>
        
        <div class="form-group form-check">
            <input type="checkbox" name="is_active" id="is_active" {{ 'checked' if block and block.is_active else 'checked' if not block else '' }}>
            <label for="is_active">Активен</label>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Сохранить</button>
            <a href="{{ url_for('admin.accessory_blocks_list', pl_id=product_line.id) }}" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
</div>

{{ wysiwyg_styles() }}
{{ wysiwyg_scripts() }}
{% endblock %}
