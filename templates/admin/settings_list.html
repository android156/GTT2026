{% extends 'admin/base.html' %}
{% block title %}Настройки{% endblock %}
{% block page_title %}Настройки{% endblock %}

{% block content %}
<div class="card">
    <form method="POST" action="{{ url_for('admin.settings_save') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <h3>Telegram</h3>
        <div class="form-group">
            <label>TELEGRAM_TOKEN</label>
            <input type="text" name="setting_TELEGRAM_TOKEN" value="{% for s in settings %}{% if s.key == 'TELEGRAM_TOKEN' %}{{ s.value }}{% endif %}{% endfor %}">
        </div>
        <div class="form-group">
            <label>TELEGRAM_CHAT_ID</label>
            <input type="text" name="setting_TELEGRAM_CHAT_ID" value="{% for s in settings %}{% if s.key == 'TELEGRAM_CHAT_ID' %}{{ s.value }}{% endif %}{% endfor %}">
        </div>
        
        <h3>Контакты</h3>
        <div class="form-group">
            <label>Телефон</label>
            <input type="text" name="setting_PHONE" value="{% for s in settings %}{% if s.key == 'PHONE' %}{{ s.value }}{% endif %}{% endfor %}">
        </div>
        <div class="form-group">
            <label>Email</label>
            <input type="text" name="setting_EMAIL" value="{% for s in settings %}{% if s.key == 'EMAIL' %}{{ s.value }}{% endif %}{% endfor %}">
        </div>
        <div class="form-group">
            <label>Адрес</label>
            <input type="text" name="setting_ADDRESS" value="{% for s in settings %}{% if s.key == 'ADDRESS' %}{{ s.value }}{% endif %}{% endfor %}">
        </div>
        
        <button type="submit" class="btn btn-primary">Сохранить настройки</button>
    </form>
</div>

<div class="card" style="margin-top: 20px;">
    <h3>Водяной знак</h3>
    <p style="color: #666; margin-bottom: 15px;">Водяной знак накладывается поверх изображений в галереях (услуги, линейки, главная). Рекомендуется PNG с прозрачностью.</p>
    
    {% set watermark_setting = settings|selectattr('key', 'equalto', 'WATERMARK_IMAGE')|first %}
    {% set watermark_path = watermark_setting.value if watermark_setting else '' %}
    
    {% if watermark_path %}
    <div style="margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 4px;">
        <p><strong>Текущий водяной знак:</strong></p>
        <img src="/{{ watermark_path }}" alt="Водяной знак" style="max-width: 300px; max-height: 100px; border: 1px solid #ddd; background: #fff;">
        <form method="POST" action="{{ url_for('admin.watermark_delete') }}" style="display: inline-block; margin-left: 15px;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Удалить водяной знак?');">Удалить</button>
        </form>
    </div>
    {% else %}
    <p style="color: #999; margin-bottom: 15px;"><em>Водяной знак не загружен</em></p>
    {% endif %}
    
    <form method="POST" action="{{ url_for('admin.watermark_upload') }}" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <label>{% if watermark_path %}Заменить водяной знак{% else %}Загрузить водяной знак{% endif %}</label>
            <input type="file" name="watermark" accept="image/png,image/jpeg,image/webp" required>
        </div>
        <button type="submit" class="btn btn-primary">Загрузить</button>
    </form>
</div>
{% endblock %}
